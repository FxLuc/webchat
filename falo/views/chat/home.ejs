<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../link/head.ejs'); %>
    <title>Falo</title>
</head>

<body style="height: 100vh; position: relative;">
  <nav class="navbar navbar-dark bg-info justify-content-between px-3">
    <h1 class="my-0" style="line-height: 0;">
      <a class="navbar-brand py-0" href="/">
        <img src="images/main/logo_F_light.png" width="30" height="30" class="d-inline-block align-top" alt="FALO logo">
        <span class="" style="font-family: 'Trebuchet MS'; font-size: 35px; line-height: 0.9;">Falo</span>
      </a>
    </h1>
    <div class="">
      <a href="/signout" class="btn btn-outline-light">ĐĂNG XUẤT <em class="fas fa-sign-out-alt"></em></a>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row row flex-md-nowrap">
      <div class="col-12 col-md-4 col-xl-3 pt-2">
        <p> <em class="fas fa-user-alt"></em> <strong id="user_email">
            <%= user.email %>
          </strong></p>
          <p>Account email: <%= user.email %>
          </p>
          <p>Account id: <%= user.id %>
          </p>
          <p>Account type: <%= user.role %>
          </p>
      </div>
      <div class="col-12 col-md-8 col-xl-9">
        <ul id="chatBox"></ul>
        <form id="formChat" action="javascript:;">
          <input id="inputMessage" autocomplete="off" /><button>Send</button>
        </form>
      </div>
    </div>
  </div>

  <%- include('../link/script.ejs'); %>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
      var socket = io()

      var chatBox = document.getElementById('chatBox')
      var formChat = document.getElementById('formChat')
      var userEmail = document.getElementById('user_email').innerText
      var inputMessage = document.getElementById('inputMessage')

      formChat.addEventListener('submit', data => {
        data.preventDefault()
        if (inputMessage.value) {
          socket.emit('chat_box', { from: userEmail, msg: inputMessage.value } )
          inputMessage.value = ''
        }
      })

      socket.on('chat_box', data => {
        var item = document.createElement('li')
        item.textContent = `${data.from}: ${data.msg}`
        chatBox.appendChild(item)
        window.scrollTo(0, document.body.scrollHeight)
      })
    </script>
</body>

</html>